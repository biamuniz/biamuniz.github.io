{
  "hash": "73a9ee8980ad020f023d5868532240d9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"DataBia nos EUA\"\nsubtitle: \"Lidando com as diferentes temperaturas em Austin e NYC\"\ndate: \"2024-03-24\"\ncategories: \n# exemplo de categorias:\n  - \"Texas\"\n  - \"R\"\n  - \"Intercâmbio\"\n  - \"NYC\"\nlang: pt\ntoc: true \ndraft: false\nimage: \"images/sonic.jpg\"\nexecute: \n  warning: false\n  message: false\n---\n\n\nEsse post é um relato \"dataficado\" sobre minha experiência nos EUA! Coletei e estruturei muitos dados desse período, aqueles que já rastreio automaticamente (como scrobbles do last.fm) ou os que tive que monitorar para prestação de contas (o câmbio, minhas notas fiscais). Achei que seria bacana treinar minha fluência no tidyverse e conhecer outros pacotes do R revisitando umas informações do meu período de intercâmbio. Começando pela minha reclamação mais frequente: a temperatura.\n\nEstive nos EUA durante quatro meses em 2022, entre setembro e dezembro, do final do verão até o começo do inverno. Precisei lidar com o calor texano de 30°C (e muito suor, pressão baixa e protetor solar) e temperaturas negativas no inverno de Nova York (e o hábito de entrar em cafés quentinhos apenas pra reter o calor do meu corpo por uns minutos). Perrengues chiques estadunidenses.\n\n\nEu não gosto das altas temperaturas. Até canto *ai que delícia o verão, a gente mostra o ombrinho* etc mas minha ligação com o calor acaba aí. Eu tenho pressão baixa, então a maior parte do tempo me preocupava em não passar mal (o que aconteceu algumas vezes no TX).\n\n![Bonés, chapéus e óculos de sol viraram meus acessórios favoritos](images/sol.jpg){fig-align=\"center\"}\n\nPor outro lado, eu não tinha ideia do que era viver temperaturas tão baixas a ponto de travar meu celular ou de ver lagos congelados. Quando chegou o inverno, não tinha roupas pra um friozão porque acreditava que meu moletom universitário era suficiente hehe estava BEM enganada. Lá vai eu comprar um casacão nos outlets.\n\nPensando nessas nuances na temperatura, fiz um gráfico que mostra as temperaturas diárias que encarei enquanto estive nos EUA.\n\n## Mãos à obra\n\n### Setup inicial\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Carregando os pacotes\nlibrary(tidyverse) #para lidar com os dados (ggplot tá aí!)\nlibrary(lubridate) #para lidar com as datas\nlibrary(weathermetrics) #para converter a temperatura\nlibrary(janitor) #clean_names\nlibrary(ggtext) # para suportar texto com HTML\nlibrary(glue) # para criar strings\n\nSys.setlocale(\"LC_TIME\", \"pt_BR.UTF-8\")\n## [1] \"pt_BR.UTF-8\"\n```\n:::\n\n\nOs dados eu peguei pra uma tarefa da disciplina *Reporting With Data*. Exportei do site os registros das estações de Austin e de Nova York, no período entre setembro e dezembro de 2022. Alguns desafios:\n\\* Selecionar o período específico em que eu estive em cada cidade; \n\\* Como a temperatura estava em Fahrenheit, tive que converter para Celsius (afinal, aqui é BR). Usei o pacote `weathermetrics` pra essa tarefa \n\\* Acrescentar dados de São Paulo (onde estive na primeira semana de setembro); \n\\* Formatar datas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Carregando os dados\ndf <- read.csv(\"data/3643365.csv\") |> \n  clean_names()\n\n#Formatando as datas\ndf$date <- as.Date(df$date, format = \"%Y-%m-%d\")\n\n# Filtrando os dados de acordo com as condições de data e estação metereológica\nfiltered_df <- df %>%\n  filter((station == \"USW00013958\" & date >= as.Date(\"2022-09-01\") & date <= as.Date(\"2022-12-22\")) |\n         (station == \"USW00014732\" & date >= as.Date(\"2022-12-23\")))\n\n# converte os dados de fahrenheit para celsius\nfiltered_df$tmin <- fahrenheit.to.celsius(filtered_df$tmin)\nfiltered_df$tmax <- fahrenheit.to.celsius(filtered_df$tmax)\n```\n:::\n\n\nAgora tenho um dataframe com registros das temperaturas de Austin e Nova York. Porém, eu fiquei um tempinho de setembro em SP. Achava errado não incluir essa informação, então adicionei as temperaturas entre 1 e 6 de setembro:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Substituição de dados do começo de setembro pela temperatura registrada em SP\nsp_data <- data.frame(\n  name = c(\"SAO PAULO\", \"SAO PAULO\", \"SAO PAULO\", \"SAO PAULO\", \"SAO PAULO\", \"SAO PAULO\"),\n  date = c(\"2022-09-01\", \"2022-09-02\", \"2022-09-03\", \"2022-09-04\", \"2022-09-05\", \"2022-09-06\"),\n  tmin = c(10.3, 12.5, 15.5, 10, 11.3, 13.7),\n  tmax = c(26.9, 30.2, 23.7, 15.1, 19.3, 23.9)\n)\n\n# Converter strings de data para tipo Date, se ainda não estiverem\nsp_data$date <- as.Date(sp_data$date, format = \"%Y-%m-%d\")\n\n# Substituição dos valores de temperatura\nfiltered_df <- filtered_df %>%\n  mutate(\n    name = ifelse(date %in% sp_data$date, sp_data$name[match(date, sp_data$date)], name),\n    tmin = ifelse(date %in% sp_data$date, sp_data$tmin[match(date, sp_data$date)], tmin),\n    tmax = ifelse(date %in% sp_data$date, sp_data$tmax[match(date, sp_data$date)], tmax)\n  )\n\nfiltered_df<-filtered_df |> select(name, date, tmin, tmax)\n```\n:::\n\n\n### Plotando o gráfico\n\nO processo de criar o gráfico foi ok; sabia que precisava fazer um \"lollipop\". Mas não contava com o transtorno que é criar anotações e posicioná-las corretamente. Foi bem \"tentativa e erro\" essa parte, mas gostei do resultado.\n\nPrimeiro, eu calculei os dias com maiores e menores valores para temperatura e amplitude térmica:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndia_com_menor_temperatura <- filtered_df %>% filter(tmin == min(tmin))\ndia_com_maior_temperatura <- filtered_df %>% filter(tmax == max(tmax))\ndia_com_maior_amplitude <- filtered_df %>% mutate(amplitude = tmax - tmin) %>% filter(amplitude == max(amplitude))\ndia_com_menor_amplitude <- filtered_df %>% mutate(amplitude = tmax - tmin) %>% filter(amplitude == min(amplitude))\n```\n:::\n\n\nTambém estilizei o título. Vi numa edição da newsletter do Albert Rapp esse jeito de colocar o título e achei uma boa sacada, porque posso retirar a legenda.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\n# Use o ggtext para o subtitle que requer HTML\nmy_title <- glue(\n  \"Temperaturas <b><span style = 'color:blue;'>mínimas</span></b> e <b><span style = 'color:orange;'>máximas</span></b> durante meu período nos EUA\"\n)\n```\n:::\n\n\nO resultado! Admito que não ficou TÃO do jeito que eu queria, mas gostei de fazer um gráfico inteirinho no R, sem precisar de algum software de design (viva o software livre).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Use o ggtext para o subtitle que requer HTML\nmy_title <- glue(\n  \"Temperaturas <b><span style = 'color:blue;'>mínimas</span></b> e <b><span style = 'color:orange;'>máximas</span></b> durante meu período nos EUA\"\n)\n\n# Cria o gráfico\nfigura <- ggplot(\n  filtered_df, aes(x = date)) +\n  geom_segment(aes(x = date, xend = date, y = tmin, yend = tmax)) +\n  geom_point(aes(y = tmin), color = \"blue\", size = 1) +\n  geom_point(aes(y = tmax), color = \"orange\", size = 1) +\n  geom_hline(yintercept = 0, linetype = \"solid\", color = \"black\", size = 0.5) +  # Linha na temperatura zero\n  geom_segment(\n    aes(x = as.Date(\"2022-09-07\"), \n        y = 20, \n        xend = as.Date(\"2022-09-07\"), \n        yend = -8), \n    arrow = arrow(type = \"closed\", length = unit(0.1, \"cm\")), color = \"red\") +\n  annotate(\"text\", x = as.Date(\"2022-09-07\"), y = -12, label = \"Chegada em \\nAustin: 7/set\", size = 3, color = \"black\", family=\"Raleway\") +\n  theme_minimal() +\n  labs(title = my_title,\n       subtitle = \"Registro das temperaturas nas cidades onde estive nos meses de setembro a dezembro de 2022\", \n       x = \"Dia\", \n       y = \"Temperatura (°C)\",\n       caption = \"Fontes: National Centers for Environmental Information; Climatempo. \\n\n       Gráfico por Bianca Muniz (@biancamuniz__)\") +\n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\") +\n  scale_y_continuous(breaks = seq(from = floor(min(filtered_df$tmin) / 10) * 10, to = ceiling(max(filtered_df$tmax) / 10) * 10, by = 10)) +\n  geom_vline(data = data.frame(date = seq(min(filtered_df$date), max(filtered_df$date), by = \"1 month\")),\n             aes(xintercept = date), linetype = \"dotted\", color = \"gray\") +\n  theme(plot.title = element_markdown(size = 12, family = \"Bitter\", face = \"bold\"),\n        axis.text.x = element_text(angle = 0, vjust = 0.5, hjust = -1, size = 10),\n        plot.subtitle = element_text(family = \"Bitter\", size = 10),\n        axis.title = element_text(family = \"Bitter\"),\n        panel.grid.minor = element_blank(),\n        axis.text.y = element_text(size = 10),\n        plot.caption = element_text(family = \"Bitter\")) +  labs(title = my_title)+\n  ## Adicionando setas\n  geom_curve(\n    aes(\n      x = dia_com_menor_temperatura$date -10, \n      y = min(filtered_df$tmin), \n      xend = dia_com_menor_temperatura$date, \n      yend = min(filtered_df$tmin) - 2),\n    arrow = arrow(length = unit(0.1, \"cm\")), color = \"red\") +\n  geom_curve(\n    aes(\n      x = dia_com_maior_temperatura$date, \n      y = max(filtered_df$tmax) -5, \n      xend = dia_com_maior_temperatura$date, \n      yend = max(filtered_df$tmax) + 5), \n    arrow = arrow(length = unit(0.1, \"cm\")), color = \"red\") +\n  geom_curve(\n    aes(\n      x = dia_com_maior_amplitude$date, \n      y = (max(filtered_df$tmax) + min(filtered_df$tmin)) / 2, \n      xend = dia_com_maior_amplitude$date, \n      yend = max(filtered_df$tmax) + 4), \n    arrow = arrow(length = unit(0.1, \"cm\")), color = \"red\") +\n  geom_curve(aes(x = as.Date(\"2022-09-07\"), y = 10, xend = as.Date(\"2022-10-16\"), yend = 10), \n             curvature = 0, color = \"red\") +  # Colchete\n  annotate(\"text\", x = as.Date(\"2022-09-25\"), y = 5, label = \"40 dias seguidos com \\ntemperaturas acima de 30°C\", \n           size = 3, color = \"black\", family = \"Raleway\") + # Use o markdown para o subtítulo# Diminui o tamanho do subtítulo\n  ## Adicionando anotações\n  annotate(\n    \"text\", \n    x = dia_com_menor_temperatura$date - 30, \n    y = min(filtered_df$tmin) - 4, \n    label = \"Menor temperatura \\nem todo o período:\\n-13°C em NYC\", \n    hjust = 0, \n    vjust = 0, \n    size = 3, \n    color = \"black\", family = \"Raleway\") +\n  annotate(\n    \"text\", \n    x = dia_com_maior_temperatura$date, \n    y = max(filtered_df$tmax) - 2, \n    label = \"O dia mais quente: \\n22/09, 37°C\", \n    hjust = 1, \n    vjust = -0.75, \n    size = 3, \n    color = \"black\", family = \"Raleway\") +\n  annotate(\n    \"text\", \n    x = dia_com_maior_amplitude$date-10, \n    y = max(filtered_df$tmax) + 10, \n    label = \"No dia 22/12, último dia que estive no Texas \\nencarei uma diferença de 23°C entre \\nas temperaturas mínima e máxima!\", \n    hjust = 0.5, \n    vjust = 1, \n    size = 3, \n    color = \"black\",position = position_dodge(width = 0.2), family = \"Raleway\")\nfigura\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}