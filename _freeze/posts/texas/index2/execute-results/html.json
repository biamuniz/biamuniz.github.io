{
  "hash": "819911d4c8062ef0da8959f2134bdcad",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"ggploTX\"\nsubtitle: \"ou: minha experiência na cidade de Austin por meio de dados e gráficos feitos em R\"\ndate: \"2024-03-24\"\ncategories: \n# exemplo de categorias:\n  - \"Texas\"\n  - \"R\"\n  - \"Intercâmbio\"\nlang: pt\ntoc: true \ndraft: true \nexecute: \n  warning: false\n  message: false\n  freeze: true\n---\n\n\nEstive em Austin durante quatro meses em 2022. Entre setembro e dezembro, precisei lidar com #PerrenguesChiques (situações que te irritam mas vc tá no exterior, então tem um glamour nesse incômodo), como o calor texano e acompanhar as variações do dólar, mas conheci lugares, pessoas, novos hábitos maravilhosos e um pouco mais sobre mim.\n\nNa tentativa de treinar minha fluência no tidyverse e conhecer outros pacotes do R, revisitei umas informações do meu período de intercâmbio. Eu estruturei muitos dados nessa época, aqueles que já rastreio automaticamente (como scrobbles do last.fm) ou os que tive que monitorar para prestação de contas (o câmbio, minhas notas fiscais).\n\nEsse post é um relato \"dataficado\" da cidade mais esquisita do Texas e faz parte de uma série sobre o tema! Ia colocar tudo junto num post mas ficou gigante\n\n## Setup inicial\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Carregando os pacotes\nlibrary(tidyverse) #para lidar com os dados (ggplot tá aí!)\nlibrary(lubridate) #para lidar com as datas\nlibrary(weathermetrics) #para converter a temperatura\nlibrary(janitor) #clean_names\nlibrary(ggtext) # para suportar texto com HTML\nlibrary(glue) # para criar strings\n\nSys.setlocale(\"LC_TIME\", \"pt_BR.UTF-8\")\n## [1] \"pt_BR.UTF-8\"\n```\n:::\n\n\n\n## Tá calor até de noite\n\n![](https://i.pinimg.com/736x/9e/f9/bf/9ef9bf2174d0c994e18a181cc0208313.jpg){fig-align=\"center\"}\n\nCheguei em Austin no finalzinho do verão, mas ainda estava muito quente para os meus padrões (ainda não conhecia os efeitos dessas ondas de calor mais recentes no Brasil né). Quando eu comentava do calor, sempre tinha alguém pra falar \"é que você não sentiu nos meses de julho e agosto\". Quase um \"lá em Curitiba\" reverso.\n\nEu não gosto das altas temperaturas. Até canto *ai que delícia o verão, a gente mostra o ombrinho* etc mas minha ligação com o calor acaba aí. Eu tenho pressão baixa então a maior parte do tempo me preocupava em não passar mal (o que aconteceu algumas vezes no TX).\n\n![Bonés, chapéus e óculos de sol viraram meus acessórios favoritos](images/sol.jpg){fig-align=\"center\"}\n\n\n## Importando os dados\nOs dados eu peguei pra uma tarefa da disciplina *Reporting With Data*. Exportei do site os registros das estações de Austin e de Nova York, no período entre setembro e dezembro de 2022.\nAlguns desafios:\n* Selecionar o período específico em que eu estive em cada cidade;\n* Como a temperatura estava em Fahrenheit, tive que converter para Celsius (afinal, aqui é BR). Usei o pacote `weathermetrics` pra essa tarefa\n* Acrescentar dados de São Paulo (onde estive na primeira semana de setembro)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Carregando os dados\n## Temperatura\ndf <- read.csv(\"data-raw/3643365.csv\") |> \n  clean_names()\ndf$date <- as.Date(df$date, format = \"%Y-%m-%d\")\n\n# Filtrando os dados de acordo com suas condições\nfiltered_df <- df %>%\n  filter((station == \"USW00013958\" & date >= as.Date(\"2022-09-01\") & date <= as.Date(\"2022-12-22\")) |\n         (station == \"USW00014732\" & date >= as.Date(\"2022-12-23\")))\n\n# converte os dados de fahrenheit para celsius\nfiltered_df$tmin <- fahrenheit.to.celsius(filtered_df$tmin)\nfiltered_df$tmax <- fahrenheit.to.celsius(filtered_df$tmax)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Dados de substituição\nsubstitute_data <- data.frame(\n  name = c(\"SAO PAULO\", \"SAO PAULO\", \"SAO PAULO\", \"SAO PAULO\", \"SAO PAULO\", \"SAO PAULO\"),\n  date = c(\"2022-09-01\", \"2022-09-02\", \"2022-09-03\", \"2022-09-04\", \"2022-09-05\", \"2022-09-06\"),\n  tmin = c(10.3, 12.5, 15.5, 10, 11.3, 13.7),\n  tmax = c(26.9, 30.2, 23.7, 15.1, 19.3, 23.9)\n)\n\n# Converter strings de data para tipo Date, se ainda não estiverem\nsubstitute_data$date <- as.Date(substitute_data$date, format = \"%Y-%m-%d\")\n\n# Substituição dos valores de temperatura\nfiltered_df <- filtered_df %>%\n  mutate(\n    name = ifelse(date %in% substitute_data$date, substitute_data$name[match(date, substitute_data$date)], name),\n    tmin = ifelse(date %in% substitute_data$date, substitute_data$tmin[match(date, substitute_data$date)], tmin),\n    tmax = ifelse(date %in% substitute_data$date, substitute_data$tmax[match(date, substitute_data$date)], tmax)\n  )\n\nfiltered_df<-filtered_df |> select(name, date, tmin, tmax)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n\n# Use o ggtext para o subtitle que requer HTML\nmy_title <- glue(\n  \"Temperaturas <b><span style = 'color:blue;'>mínimas</span></b> e <b><span style = 'color:orange;'>máximas</span></b> enquanto estive nos EUA\"\n)\n\n\n# Cria o gráfico\nfigura <- ggplot(\n  filtered_df, aes(x = date)) + \n  geom_rect(aes(xmin = as.Date(\"2022-09-01\"), xmax = as.Date(\"2022-09-06\"), ymin = -Inf, ymax = Inf), fill = \"red\", alpha =0.001) +\n  geom_rect(aes(xmin = as.Date(\"2022-09-07\"), xmax = as.Date(\"2022-12-22\"), ymin = -Inf, ymax = Inf), fill = \"orange\", alpha = 0.001) +\n  geom_rect(aes(xmin = as.Date(\"2022-12-23\"), xmax = max(filtered_df$date), ymin = -Inf, ymax = Inf), fill = \"lightblue\", alpha = 0.001) +\n  geom_segment(aes(x = date, xend = date, y = tmin, yend = tmax)) +\n  geom_point(aes(y = tmin), color = \"blue\", size = 1) +\n  geom_point(aes(y = tmax), color = \"orange\", size = 1) +\n  theme_minimal() +\n  labs(title = my_title,\n       subtitle = \"Registros diários dos lugares onde estive nos meses de setembro a agosto de 2022\", \n       x = \"Dia\", \n       y = \"Temperatura (°C)\") +\n  scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\") +\n  geom_vline(data = data.frame(date = seq(min(filtered_df$date), max(filtered_df$date), by = \"1 month\")),\n             aes(xintercept = date), linetype = \"dashed\", color = \"gray\") +\n  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust = -1, size = 10),\n            plot.title = ggtext::element_markdown())\nfigura\n```\n\n::: {.cell-output-display}\n![](index2_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndia_com_menor_temperatura <- filtered_df %>% filter(tmin == min(tmin))\ndia_com_maior_temperatura <- filtered_df %>% filter(tmax == max(tmax))\ndia_com_maior_amplitude <- filtered_df %>% mutate(amplitude = tmax - tmin) %>% filter(amplitude == max(amplitude))\n\n# Adicionar anotações com setas\np <- figura + \n  annotate(\n    \"text\", \n    x = dia_com_menor_temperatura$date, \n    y = min(filtered_df$tmin) - 5, \n    label = \"Menor temperatura aconteceu \\nno outono: dia 13/11, 1°C\", \n    hjust = 0, \n    vjust = 0, \n    size = 3, \n    color = \"black\") +\n  annotate(\n    \"text\", \n    x = dia_com_maior_temperatura$date, \n    y = max(filtered_df$tmax) + 5, \n    label = \"O dia mais quente: \\n22/09, 37°C\", \n    hjust = 1, \n    vjust = -0.75, \n    size = 3, \n    color = \"black\") +\n  annotate(\n    \"text\", \n    x = dia_com_maior_amplitude$date, \n    y = max(filtered_df$tmax) + 10, \n    label = \"No dia 20/10 encarei uma diferença de 20°C \\nentre as temperaturas mínima e máxima!\", \n    hjust = 0.5, \n    vjust = 1, \n    size = 3, \n    color = \"black\") +\n  geom_curve(\n    aes(\n      x = dia_com_menor_temperatura$date, \n      y = min(filtered_df$tmin), \n      xend = dia_com_menor_temperatura$date, \n      yend = min(filtered_df$tmin) - 2),\n    arrow = arrow(length = unit(0.1, \"cm\")), color = \"black\") +\n  geom_curve(\n    aes(\n      x = dia_com_maior_temperatura$date, \n      y = max(filtered_df$tmax), \n      xend = dia_com_maior_temperatura$date, \n      yend = max(filtered_df$tmax) + 8), \n    arrow = arrow(length = unit(0.1, \"cm\")), color = \"black\") +\n  geom_curve(\n    aes(\n      x = dia_com_maior_amplitude$date, \n      y = (max(filtered_df$tmax) + min(filtered_df$tmin)) / 2, \n      xend = dia_com_maior_amplitude$date, \n      yend = max(filtered_df$tmax) + 4), \n    arrow = arrow(length = unit(0.1, \"cm\")), color = \"black\") +\n  theme(\n    axis.text.x = element_text(angle = 0, vjust = 0.5, size = 10),\n    axis.text.y = element_text(size = 10),\n    plot.subtitle = element_text(size = 10), # Diminui o tamanho do título\n    plot.title = ggtext::element_markdown()) # Use o markdown para o subtítulo# Diminui o tamanho do subtítulo\np\n```\n\n::: {.cell-output-display}\n![](index2_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}